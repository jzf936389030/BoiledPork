<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://jzf936389030.github.io/BoiledPork</id>
    <title>BoiledPork</title>
    <updated>2022-10-18T03:32:37.378Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://jzf936389030.github.io/BoiledPork"/>
    <link rel="self" href="https://jzf936389030.github.io/BoiledPork/atom.xml"/>
    <subtitle>vbb-æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://jzf936389030.github.io/BoiledPork/images/avatar.png</logo>
    <icon>https://jzf936389030.github.io/BoiledPork/favicon.ico</icon>
    <rights>All rights reserved 2022, BoiledPork</rights>
    <entry>
        <title type="html"><![CDATA[æ·±å…¥å­¦ä¹ ï¼šspringä¸‰çº§ç¼“å­˜ï¼Œè§£å†³å¾ªç¯ä¾èµ–]]></title>
        <id>https://jzf936389030.github.io/BoiledPork/post/shen-ru-xue-xi-spring-san-ji-huan-cun-jie-jue-xun-huan-yi-lai/</id>
        <link href="https://jzf936389030.github.io/BoiledPork/post/shen-ru-xue-xi-spring-san-ji-huan-cun-jie-jue-xun-huan-yi-lai/">
        </link>
        <updated>2022-10-11T03:48:39.000Z</updated>
        <content type="html"><![CDATA[<h3 id="1ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–">1.ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–ï¼Ÿ</h3>
<p>å¾ªç¯ä¾èµ–ï¼šè¯´ç™½æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡å®ä¾‹ä¹‹é—´å­˜åœ¨ç›´æ¥æˆ–é—´æ¥çš„ä¾èµ–å…³ç³»ï¼Œè¿™ç§ä¾èµ–å…³ç³»æ„æˆäº†æ„æˆä¸€ä¸ªç¯å½¢è°ƒç”¨ã€‚<br>
ç¬¬ä¸€ç§æƒ…å†µï¼šè‡ªå·±ä¾èµ–è‡ªå·±çš„ç›´æ¥ä¾èµ–</p>
<pre><code class="language-java">@Service
public class A {
    @Autowired
    private A a;
}
</code></pre>
<p><img src="https://jzf936389030.github.io/BoiledPork/post-images/1665470298494.png" alt="" loading="lazy"><br>
ç¬¬äºŒç§æƒ…å†µï¼šä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„ç›´æ¥ä¾èµ–</p>
<pre><code class="language-java">@Service
public class A {
    @Autowired
    private B b;
}

@Service
public class B {
    @Autowired
    private A a;
}
</code></pre>
<p><img src="https://jzf936389030.github.io/BoiledPork/post-images/1665470323486.png" alt="" loading="lazy"><br>
ç¬¬ä¸‰ç§æƒ…å†µï¼šå¤šä¸ªå¯¹è±¡ä¹‹é—´çš„é—´æ¥ä¾èµ–</p>
<pre><code class="language-java">@Service
public class A {
    @Autowired
    private B b;
}

@Service
public class B {
    @Autowired
    private C c;
}
@Service
public class C {
    @Autowired
    private A a;
}
</code></pre>
<p><img src="https://jzf936389030.github.io/BoiledPork/post-images/1665470329309.png" alt="" loading="lazy"><br>
å‰ä¸¤ç§åœºæ™¯ï¼Œå¾—ç›Šäºspringå¼ºå¤§çš„åŠŸèƒ½ï¼Œå¸®æˆ‘ä»¬å®Œç¾é¢è§„é¿æ‰äº†ã€‚<br>
è‡³äºspringæ˜¯å¦‚ä½•è§£å†³çš„æˆ‘ä»¬ä¸‹é¢è¯¦ç»†çš„è¿›è¡Œä»‹ç»ã€‚</p>
<h3 id="2beançš„åˆ›å»ºæµç¨‹">2.beançš„åˆ›å»ºæµç¨‹</h3>
<p>åœ¨æ·±å…¥åˆ†æä¸‰çº§ç¼“å­˜ä¹‹å‰ï¼Œå¾—å…ˆäº†è§£springåˆ›å»ºbeançš„æµç¨‹<br>
<img src="https://jzf936389030.github.io/BoiledPork/post-images/1665471176068.png" alt="" loading="lazy"></p>
<ul>
<li>createBeanInstanceï¼šå®ä¾‹åŒ–ï¼Œå…¶å®ä¹Ÿå°±æ˜¯è°ƒç”¨å¯¹è±¡çš„æ„é€ æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡</li>
<li>populateBeanï¼šå¡«å……å±æ€§ï¼Œè¿™ä¸€æ­¥ä¸»è¦æ˜¯å¯¹beançš„ä¾èµ–å±æ€§è¿›è¡Œæ³¨å…¥(@Autowired)</li>
<li>initializeBeanï¼šå›åˆ°ä¸€äº›å½¢å¦‚initMethodã€InitializingBeanç­‰æ–¹æ³•<br>
ä»å›¾ä¸­ å•ä¾‹Beançš„åˆå§‹åŒ–å¯ä»¥çœ‹å‡ºï¼Œå¾ªç¯ä¾èµ–ä¸»è¦å‘ç”Ÿåœ¨ç¬¬äºŒæ­¥ï¼ˆpopulateBeanï¼‰ï¼Œä¹Ÿå°±æ˜¯fieldå±æ€§æ³¨å…¥çš„å¤„ç†ã€‚</li>
</ul>
<h3 id="3springå†…éƒ¨çš„ä¸‰çº§ç¼“å­˜">3.springå†…éƒ¨çš„ä¸‰çº§ç¼“å­˜</h3>
<ul>
<li>singletonObjects  ä¸€çº§ç¼“å­˜ï¼Œç”¨äºä¿å­˜å®ä¾‹åŒ–ã€æ³¨å…¥ã€åˆå§‹åŒ–å®Œæˆçš„beanå®ä¾‹</li>
<li>earlySingletonObjects  äºŒçº§ç¼“å­˜ï¼Œç”¨äºä¿å­˜å®ä¾‹åŒ–å®Œæˆçš„beanå®ä¾‹</li>
<li>singletonFactories  ä¸‰çº§ç¼“å­˜ï¼Œç”¨äºä¿å­˜beanåˆ›å»ºå·¥å‚ï¼Œä»¥ä¾¿äºåé¢æ‰©å±•æœ‰æœºä¼šåˆ›å»ºä»£ç†å¯¹è±¡ã€‚</li>
</ul>
<p><strong>è¯¦è§£</strong><br>
æ‰€æœ‰è¢« Spring ç®¡ç†çš„ Beanï¼Œæœ€ç»ˆéƒ½ä¼šå­˜æ”¾åœ¨ singletonObjects ä¸­ï¼Œè¿™é‡Œé¢å­˜æ”¾çš„ Bean æ˜¯ç»å†äº†æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼ˆé™¤äº†é”€æ¯çš„ç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œå®Œæ•´çš„ï¼Œå¯ä»¥ç»™ç”¨æˆ·ä½¿ç”¨çš„ã€‚</p>
<p>earlySingletonObjects å­˜æ”¾çš„æ˜¯å·²ç»è¢«å®ä¾‹åŒ–ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ³¨å…¥å±æ€§å’Œæ‰§è¡Œ init æ–¹æ³•çš„ Beanã€‚</p>
<p>singletonFactories å­˜æ”¾çš„æ˜¯ç”Ÿäº§ Bean çš„å·¥å‚ã€‚</p>
<p>Bean éƒ½å·²ç»å®ä¾‹åŒ–äº†ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ä¸€ä¸ªç”Ÿäº§ Bean çš„å·¥å‚å‘¢ï¼Ÿè¿™é‡Œå®é™…ä¸Šæ˜¯è·Ÿ AOP æœ‰å…³ï¼Œå¦‚æœé¡¹ç›®ä¸­ä¸éœ€è¦ä¸º Bean è¿›è¡Œä»£ç†ï¼Œé‚£ä¹ˆè¿™ä¸ª Bean å·¥å‚å°±ä¼šç›´æ¥è¿”å›ä¸€å¼€å§‹å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ AOP è¿›è¡Œä»£ç†ï¼Œé‚£ä¹ˆè¿™ä¸ªå·¥å‚å°±ä¼šå‘æŒ¥é‡è¦çš„ä½œç”¨äº†ï¼Œè¿™ä¹Ÿæ˜¯æœ¬æ–‡éœ€è¦é‡ç‚¹å…³æ³¨çš„é—®é¢˜ä¹‹ä¸€ã€‚</p>
<pre><code class="language-java">public class DefaultSingletonBeanRegistry extends SimpleAliasRegistry implements SingletonBeanRegistry {
	...
	// ä»ä¸Šè‡³ä¸‹ åˆ†è¡¨ä»£è¡¨è¿™â€œä¸‰çº§ç¼“å­˜â€
	private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;(256); //ä¸€çº§ç¼“å­˜
	private final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap&lt;&gt;(16); // äºŒçº§ç¼“å­˜
	private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap&lt;&gt;(16); // ä¸‰çº§ç¼“å­˜
	...
	
	/** Names of beans that are currently in creation. */
	// è¿™ä¸ªç¼“å­˜ä¹Ÿååˆ†é‡è¦ï¼šå®ƒè¡¨ç¤ºbeanåˆ›å»ºè¿‡ç¨‹ä¸­éƒ½ä¼šåœ¨é‡Œé¢å‘†ç€~
	// å®ƒåœ¨Beanå¼€å§‹åˆ›å»ºæ—¶æ”¾å€¼ï¼Œåˆ›å»ºå®Œæˆæ—¶ä¼šå°†å…¶ç§»å‡º~
	private final Set&lt;String&gt; singletonsCurrentlyInCreation = Collections.newSetFromMap(new ConcurrentHashMap&lt;&gt;(16));

	/** Names of beans that have already been created at least once. */
	// å½“è¿™ä¸ªBeanè¢«åˆ›å»ºå®Œæˆåï¼Œä¼šæ ‡è®°ä¸ºè¿™ä¸ª æ³¨æ„ï¼šè¿™é‡Œæ˜¯seté›†åˆ ä¸ä¼šé‡å¤
	// è‡³å°‘è¢«åˆ›å»ºäº†ä¸€æ¬¡çš„  éƒ½ä¼šæ”¾è¿›è¿™é‡Œ~~~~
	private final Set&lt;String&gt; alreadyCreated = Collections.newSetFromMap(new ConcurrentHashMap&lt;&gt;(256));
}
</code></pre>
<p><strong>è·å–å•ä¾‹Beançš„æºç å¦‚ä¸‹ï¼š</strong></p>
<pre><code class="language-java">public class DefaultSingletonBeanRegistry extends SimpleAliasRegistry implements SingletonBeanRegistry {
	...
	@Override
	@Nullable
	public Object getSingleton(String beanName) {
		return getSingleton(beanName, true);
	}
	@Nullable
	protected Object getSingleton(String beanName, boolean allowEarlyReference) {
	// ä»ä¸€çº§ç¼“å­˜singletonObjectsè·å–bean
	Object singletonObject = this.singletonObjects.get(beanName);
	// ä¸€çº§ç¼“å­˜æ²¡æœ‰ï¼Œåˆ¤æ–­è¯¥beanæ˜¯å¦åœ¨åˆ›å»ºä¸­ï¼Œé€šè¿‡Setçš„containsæ¥åˆ¤æ–­
	if (singletonObject == null &amp;&amp; isSingletonCurrentlyInCreation(beanName)) {
		synchronized (this.singletonObjects) {
			// ä»äºŒçº§ç¼“å­˜ä¸­è·å–bean
			singletonObject = this.earlySingletonObjects.get(beanName);
			// äºŒçº§ç¼“å­˜æ²¡æœ‰&amp;&amp;å…è®¸æå‰å¼•ç”¨
			if (singletonObject == null &amp;&amp; allowEarlyReference) {
				// ä»ä¸‰çº§ç¼“å­˜ä¸­è·å–lambdaè¡¨è¾¾å¼
				ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName);
				if (singletonFactory != null) {
					// è°ƒç”¨ä¸‰çº§ç¼“å­˜çš„lambdaè¡¨ç¤ºè·å–æ—©æœŸä¸å®Œæ•´å¯¹è±¡
					singletonObject = singletonFactory.getObject();
					// å†™å…¥äºŒçº§ç¼“å­˜
					this.earlySingletonObjects.put(beanName, singletonObject);
					// ä¸‰çº§ç¼“å­˜ç§»é™¤è¯¥beançš„lambdaè¡¨è¾¾å¼
					this.singletonFactories.remove(beanName);
				}
			}
		}
	}
	return singletonObject;
}

public boolean isSingletonCurrentlyInCreation(String beanName) {
	return this.singletonsCurrentlyInCreation.contains(beanName);
}

	...
	public boolean isSingletonCurrentlyInCreation(String beanName) {
		return this.singletonsCurrentlyInCreation.contains(beanName);
	}
	protected boolean isActuallyInCreation(String beanName) {
		return isSingletonCurrentlyInCreation(beanName);
	}
	...
}
</code></pre>
<h3 id="4beanåˆ›å»ºå…³é”®æ­¥éª¤æºç èµ°åŠ¿è§£æ">4.beanåˆ›å»ºå…³é”®æ­¥éª¤æºç èµ°åŠ¿è§£æ</h3>
<p>æ­¤å¤„ä»¥å¦‚ä¸Šçš„Aã€Bç±»çš„äº’ç›¸ä¾èµ–æ³¨å…¥ä¸ºä¾‹ï¼Œåœ¨è¿™é‡Œè¡¨è¾¾å‡ºå…³é”®ä»£ç çš„èµ°åŠ¿ï¼š<br>
1ã€å…¥å£å¤„å³æ˜¯å®ä¾‹åŒ–ã€åˆå§‹åŒ–Aè¿™ä¸ªå•ä¾‹Beanã€‚<strong>AbstractBeanFactory.doGetBean(&quot;a&quot;)</strong></p>
<pre><code class="language-java">protected &lt;T&gt; T doGetBean(...){
    // æ­¤æ—¶aä¸å­˜åœ¨ä»»ä½•ä¸€çº§ç¼“å­˜ä¸­ï¼Œä¸”ä¸æ˜¯åœ¨åˆ›å»ºä¸­  æ‰€ä»¥æ­¤å¤„è¿”å›null
	// æ­¤å¤„è‹¥ä¸ä¸ºnullï¼Œç„¶åä»ç¼“å­˜é‡Œæ‹¿å°±å¯ä»¥äº†(ä¸»è¦å¤„ç†FactoryBeanå’ŒBeanFactoryæƒ…å†µå§)
	Object beanInstance = getSingleton(beanName, false);
	... 
	// æ ‡è®°beanName aæ˜¯å·²ç»åˆ›å»ºè¿‡è‡³å°‘ä¸€æ¬¡çš„~~~ å®ƒä¼šä¸€ç›´å­˜ç•™åœ¨ç¼“å­˜é‡Œä¸ä¼šè¢«ç§»é™¤ï¼ˆé™¤éæŠ›å‡ºäº†å¼‚å¸¸ï¼‰
	// å‚è§ç¼“å­˜Set&lt;String&gt; alreadyCreated = Collections.newSetFromMap(new ConcurrentHashMap&lt;&gt;(256))
	if (!typeCheckOnly) {
		markBeanAsCreated(beanName);
	}
	...
	// è¿™ä¸ªgetSingletonæ–¹æ³•éå¸¸å…³é”®ã€‚
	//1ã€æ ‡æ³¨aæ­£åœ¨åˆ›å»ºä¸­~
	//2ã€è°ƒç”¨singletonObject = singletonFactory.getObject();ï¼ˆå®é™…ä¸Šè°ƒç”¨çš„æ˜¯createBean()æ–¹æ³•ï¼‰  å› æ­¤è¿™ä¸€æ­¥æœ€ä¸ºå…³é”®
	//3ã€æ­¤æ—¶å®ä¾‹å·²ç»åˆ›å»ºå®Œæˆ  ä¼šæŠŠaç§»é™¤æ•´æ•´åˆ›å»ºçš„ç¼“å­˜ä¸­
	//4ã€æ‰§è¡ŒaddSingleton()æ·»åŠ è¿›å»ã€‚ï¼ˆå¤‡æ³¨ï¼šæ³¨å†Œbeançš„æ¥å£æ–¹æ³•ä¸ºregisterSingletonï¼Œå®ƒä¾èµ–äºaddSingletonæ–¹æ³•ï¼‰
	sharedInstance = getSingleton(beanName, () -&gt; { ... return createBean(beanName, mbd, args); });
}
</code></pre>
<p>2ã€ä¸‹é¢è¿›å…¥åˆ°æœ€ä¸ºæ ¸å¿ƒçš„AbstractAutowireCapableBeanFactory.createBean/doCreateBean()ç¯èŠ‚ï¼Œåˆ›å»ºAçš„å®ä¾‹</p>
<pre><code class="language-java">protected Object doCreateBean(){
	...
	// ä½¿ç”¨æ„é€ å™¨/å·¥å‚æ–¹æ³•   instanceWrapperæ˜¯ä¸€ä¸ªBeanWrapper
	instanceWrapper = createBeanInstance(beanName, mbd, args);
	// æ­¤å¤„beanä¸º&quot;åŸå§‹Bean&quot;   ä¹Ÿå°±æ˜¯è¿™é‡Œçš„Aå®ä¾‹å¯¹è±¡ï¼šA@1234
	final Object bean = instanceWrapper.getWrappedInstance();
	...
	// æ˜¯å¦è¦æå‰æš´éœ²ï¼ˆå…è®¸å¾ªç¯ä¾èµ–ï¼‰  ç°åœ¨æ­¤å¤„Aæ˜¯è¢«å…è®¸çš„
	boolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp; isSingletonCurrentlyInCreation(beanName));
	
	// å…è®¸æš´éœ²ï¼Œå°±æŠŠAç»‘å®šåœ¨ObjectFactoryä¸Šï¼Œæ³¨å†Œåˆ°ä¸‰çº§ç¼“å­˜`singletonFactories`é‡Œé¢å»ä¿å­˜ç€
	// Tips:è¿™é‡Œåç½®å¤„ç†å™¨çš„getEarlyBeanReferenceæ–¹æ³•ä¼šè¢«ä¿ƒå‘ï¼Œè‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨åœ¨æ­¤å¤„åˆ›å»ºä»£ç†å¯¹è±¡ï¼ˆæ³¨æ„æ‰§è¡Œæ—¶æœº ä¸ºæ‰§è¡Œä¸‰çº§ç¼“å­˜çš„æ—¶å€™ï¼‰
	if (earlySingletonExposure) {
		addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));
	}
	...
	// exposedObject ä¸ºæœ€ç»ˆè¿”å›çš„å¯¹è±¡ï¼Œæ­¤å¤„ä¸ºåŸå§‹å¯¹è±¡beanä¹Ÿå°±æ˜¯A@1234,ä¸‹é¢ä¼šæœ‰ç”¨å¤„
	Object exposedObject = bean; 
	// ç»™A@1234å±æ€§å®Œæˆèµ‹å€¼ï¼Œ@Autowiredåœ¨æ­¤å¤„èµ·ä½œç”¨~
	// å› æ­¤æ­¤å¤„ä¼šè°ƒç”¨getBean(&quot;b&quot;)ï¼Œso ä¼šé‡å¤ä¸Šé¢æ­¥éª¤åˆ›å»ºBç±»çš„å®ä¾‹
	// æ­¤å¤„æˆ‘ä»¬å‡è®¾Bå·²ç»åˆ›å»ºå¥½äº† ä¸ºB@5678
	
	// éœ€è¦æ³¨æ„çš„æ˜¯åœ¨populateBean(&quot;b&quot;)çš„æ—¶å€™ä¾èµ–æœ‰beanAï¼Œæ‰€ä»¥æ­¤æ—¶å€™è°ƒç”¨getBean(&quot;a&quot;)æœ€ç»ˆä¼šè°ƒç”¨getSingleton(&quot;a&quot;)ï¼Œ
	//æ­¤æ—¶å€™ä¸Šé¢è¯´åˆ°çš„getEarlyBeanReferenceæ–¹æ³•å°±ä¼šè¢«æ‰§è¡Œã€‚è¿™ä¹Ÿè§£é‡Šä¸ºä½•æˆ‘ä»¬@Autowiredæ˜¯ä¸ªä»£ç†å¯¹è±¡ï¼Œè€Œä¸æ˜¯æ™®é€šå¯¹è±¡çš„æ ¹æœ¬åŸå› 
	
	populateBean(beanName, mbd, instanceWrapper);
	// å®ä¾‹åŒ–ã€‚è¿™é‡Œä¼šæ‰§è¡Œåç½®å¤„ç†å™¨BeanPostProcessorçš„ä¸¤ä¸ªæ–¹æ³•
	// æ­¤å¤„æ³¨æ„ï¼špostProcessAfterInitialization()æ˜¯æœ‰å¯èƒ½è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡çš„ï¼Œè¿™æ ·exposedObject å°±ä¸å†æ˜¯åŸå§‹å¯¹è±¡äº†  ç‰¹å¤‡æ³¨æ„å“¦~~~
	// æ¯”å¦‚å¤„ç†@Aysncçš„AsyncAnnotationBeanPostProcessorå®ƒå°±æ˜¯åœ¨è¿™ä¸ªæ—¶é—´é‡Œç”Ÿæˆä»£ç†å¯¹è±¡çš„ï¼ˆæœ‰å‘ï¼Œè¯·å°å¿ƒä½¿ç”¨@Aysncï¼‰
	exposedObject = initializeBean(beanName, exposedObject, mbd);

	... // è‡³æ­¤ï¼Œç›¸å½“äºA@1234å·²ç»å®ä¾‹åŒ–å®Œæˆã€åˆå§‹åŒ–å®Œæˆï¼ˆå±æ€§ä¹Ÿå…¨éƒ¨èµ‹å€¼äº†~ï¼‰
	// è¿™ä¸€æ­¥æˆ‘æŠŠå®ƒç†è§£ä¸ºæ ¡éªŒï¼šæ ¡éªŒï¼šæ ¡éªŒæ˜¯å¦æœ‰å¾ªç¯å¼•ç”¨é—®é¢˜~~~~~

	if (earlySingletonExposure) {
		// æ³¨æ„æ­¤å¤„ç¬¬äºŒä¸ªå‚æ•°ä¼ çš„falseï¼Œè¡¨ç¤ºä¸å»ä¸‰çº§ç¼“å­˜é‡ŒsingletonFactorieså†å»è°ƒç”¨ä¸€æ¬¡getObject()æ–¹æ³•äº†~~~
		// ä¸Šé¢å»ºè®²åˆ°äº†ç”±äºBåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šè§¦å‘Açš„ObjectFactory.getObject()  æ‰€ä»¥aæ­¤å¤„å·²ç»åœ¨äºŒçº§ç¼“å­˜earlySingletonObjectsé‡Œäº†
		// å› æ­¤æ­¤å¤„è¿”å›Açš„å®ä¾‹ï¼šA@1234
		Object earlySingletonReference = getSingleton(beanName, false);
		if (earlySingletonReference != null) {
		
			// è¿™ä¸ªç­‰å¼è¡¨ç¤ºï¼ŒexposedObjectè‹¥æ²¡æœ‰å†è¢«ä»£ç†è¿‡ï¼Œè¿™é‡Œå°±æ˜¯ç›¸ç­‰çš„
			// æ˜¾ç„¶æ­¤å¤„æˆ‘ä»¬çš„aå¯¹è±¡çš„exposedObjectå®ƒæ˜¯æ²¡æœ‰è¢«ä»£ç†è¿‡çš„  æ‰€ä»¥ifä¼šè¿›å»~
			// è¿™ç§æƒ…å†µè‡³æ­¤ï¼Œå°±å…¨éƒ¨ç»“æŸäº†~~~
			if (exposedObject == bean) {
				exposedObject = earlySingletonReference;
			}
	
			// ç»§ç»­ä»¥Aä¸ºä¾‹ï¼Œæ¯”å¦‚æ–¹æ³•æ ‡æ³¨äº†@Aysncæ³¨è§£ï¼ŒexposedObjectæ­¤æ—¶å€™å°±æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå› æ­¤å°±ä¼šè¿›åˆ°è¿™é‡Œæ¥
			//hasDependentBean(beanName)æ˜¯è‚¯å®šä¸ºtrueï¼Œå› ä¸ºgetDependentBeans(beanName)å¾—åˆ°çš„æ˜¯[&quot;b&quot;]è¿™ä¸ªä¾èµ–
			else if (!this.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) {
				String[] dependentBeans = getDependentBeans(beanName);
				Set&lt;String&gt; actualDependentBeans = new LinkedHashSet&lt;&gt;(dependentBeans.length);

				// A@1234ä¾èµ–çš„æ˜¯[&quot;b&quot;]ï¼Œæ‰€ä»¥æ­¤å¤„å»æ£€æŸ¥b
				// å¦‚æœæœ€ç»ˆå­˜åœ¨å®é™…ä¾èµ–çš„beanï¼šactualDependentBeansä¸ä¸ºç©º é‚£å°±æŠ›å‡ºå¼‚å¸¸  è¯æ˜å¾ªç¯å¼•ç”¨äº†~
				for (String dependentBean : dependentBeans) {
					// è¿™ä¸ªåˆ¤æ–­åŸåˆ™æ˜¯ï¼šå¦‚æœæ­¤æ—¶å€™bå¹¶è¿˜æ²¡æœ‰åˆ›å»ºå¥½ï¼Œthis.alreadyCreated.contains(beanName)=trueè¡¨ç¤ºæ­¤beanå·²ç»è¢«åˆ›å»ºè¿‡ï¼Œå°±è¿”å›false
					// è‹¥è¯¥beanæ²¡æœ‰åœ¨alreadyCreatedç¼“å­˜é‡Œï¼Œå°±æ˜¯è¯´æ²¡è¢«åˆ›å»ºè¿‡(å…¶å®åªæœ‰CreatedForTypeCheckOnlyæ‰ä¼šæ˜¯æ­¤ä»“åº“)
					if (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) {
						actualDependentBeans.add(dependentBean);
					}
				}
				if (!actualDependentBeans.isEmpty()) {
					throw new BeanCurrentlyInCreationException(beanName,
							&quot;Bean with name '&quot; + beanName + &quot;' has been injected into other beans [&quot; +
							StringUtils.collectionToCommaDelimitedString(actualDependentBeans) +
							&quot;] in its raw version as part of a circular reference, but has eventually been &quot; +
							&quot;wrapped. This means that said other beans do not use the final version of the &quot; +
							&quot;bean. This is often the result of over-eager type matching - consider using &quot; +
							&quot;'getBeanNamesOfType' with the 'allowEagerInit' flag turned off, for example.&quot;);
				}
			}
		}
	}
}
</code></pre>
<p>è¿™é‡Œç»™å‡ºä¸€å¼ ç½‘ä¸Šæ•´ç†å•ŠAã€Båˆ›å»ºçš„æµç¨‹å›¾ï¼š(test1ã€test2ä»£æŒ‡Aã€B)<br>
<img src="https://jzf936389030.github.io/BoiledPork/post-images/1665488653354.png" alt="" loading="lazy"><br>
ç”¨æ–‡å­—å†æè¿°ä¸€éï¼š</p>
<ul>
<li>å®ä¾‹åŒ– Aï¼Œæ­¤æ—¶ A è¿˜æœªå®Œæˆå±æ€§å¡«å……å’Œåˆå§‹åŒ–æ–¹æ³•ï¼ˆ@PostConstructï¼‰çš„æ‰§è¡Œï¼ŒA åªæ˜¯ä¸€ä¸ªåŠæˆå“ã€‚</li>
<li>ä¸º A åˆ›å»ºä¸€ä¸ª Bean å·¥å‚ï¼Œå¹¶æ”¾å…¥åˆ° singletonFactories ä¸­ã€‚</li>
<li>å‘ç° A éœ€è¦æ³¨å…¥ B å¯¹è±¡ï¼Œä½†æ˜¯ä¸€çº§ã€äºŒçº§ã€ä¸‰çº§ç¼“å­˜å‡ä¸ºå‘ç°å¯¹è±¡ Bã€‚</li>
<li>å®ä¾‹åŒ– Bï¼Œæ­¤æ—¶ B è¿˜æœªå®Œæˆå±æ€§å¡«å……å’Œåˆå§‹åŒ–æ–¹æ³•ï¼ˆ@PostConstructï¼‰çš„æ‰§è¡Œï¼ŒB åªæ˜¯ä¸€ä¸ªåŠæˆå“ã€‚</li>
<li>ä¸º B åˆ›å»ºä¸€ä¸ª Bean å·¥å‚ï¼Œå¹¶æ”¾å…¥åˆ° singletonFactories ä¸­ã€‚</li>
<li>å‘ç° B éœ€è¦æ³¨å…¥ A å¯¹è±¡ï¼Œæ­¤æ—¶åœ¨ä¸€çº§ã€äºŒçº§æœªå‘ç°å¯¹è±¡ Aï¼Œä½†æ˜¯åœ¨ä¸‰çº§ç¼“å­˜ä¸­å‘ç°äº†å¯¹è±¡ Aï¼Œä»ä¸‰çº§ ç¼“å­˜ä¸­å¾—åˆ°å¯¹è±¡ Aï¼Œå¹¶å°†å¯¹è±¡ A æ”¾å…¥äºŒçº§ç¼“å­˜ä¸­ï¼ŒåŒæ—¶åˆ é™¤ä¸‰çº§ç¼“å­˜ä¸­çš„å¯¹è±¡ Aã€‚ï¼ˆæ³¨æ„ï¼Œæ­¤æ—¶çš„ A è¿˜æ˜¯ä¸€ä¸ªåŠæˆå“ï¼Œå¹¶æ²¡æœ‰å®Œæˆå±æ€§å¡«å……å’Œæ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•ï¼‰</li>
<li>å°†å¯¹è±¡ A æ³¨å…¥åˆ°å¯¹è±¡ B ä¸­ã€‚</li>
<li>å¯¹è±¡ B å®Œæˆå±æ€§å¡«å……ï¼Œæ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•ï¼Œå¹¶æ”¾å…¥åˆ°ä¸€çº§ç¼“å­˜ä¸­ï¼ŒåŒæ—¶åˆ é™¤äºŒçº§ç¼“å­˜ä¸­çš„å¯¹è±¡ Bã€‚ï¼ˆæ­¤æ—¶å¯¹è±¡ B å·²ç»æ˜¯ä¸€ä¸ªæˆå“ï¼‰<br>
å¯¹è±¡ A å¾—åˆ°å¯¹è±¡ Bï¼Œå°†å¯¹è±¡ B æ³¨å…¥åˆ°å¯¹è±¡ A ä¸­ã€‚ï¼ˆå¯¹è±¡ A å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ Bï¼‰<br>
å¯¹è±¡ A å®Œæˆå±æ€§å¡«å……ï¼Œæ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•ï¼Œå¹¶æ”¾å…¥åˆ°ä¸€çº§ç¼“å­˜ä¸­ï¼ŒåŒæ—¶åˆ é™¤äºŒçº§ç¼“å­˜ä¸­çš„å¯¹è±¡ Aã€‚</li>
<li>åˆ°æ­¤ï¼ŒBæŒæœ‰çš„å·²ç»æ˜¯åˆå§‹åŒ–å®Œæˆçš„Aï¼ŒAæŒæœ‰çš„ä¹Ÿæ˜¯åˆå§‹åŒ–å®Œæˆçš„B</li>
</ul>
<h3 id="æé—®ä¸‰çº§ç¼“å­˜çš„ä½œç”¨">æé—®ï¼šä¸‰çº§ç¼“å­˜çš„ä½œç”¨</h3>
<p>æ·»åŠ ä¸‰çº§ç¼“å­˜çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">protected void addSingletonFactory(String beanName, ObjectFactory&lt;?&gt; singletonFactory) {
  Assert.notNull(singletonFactory, &quot;Singleton factory must not be null&quot;);
  synchronized (this.singletonObjects) {
    if (!this.singletonObjects.containsKey(beanName)) { // åˆ¤æ–­ä¸€çº§ç¼“å­˜ä¸­ä¸å­˜åœ¨æ­¤å¯¹è±¡
      this.singletonFactories.put(beanName, singletonFactory); // æ·»åŠ è‡³ä¸‰çº§ç¼“å­˜
      this.earlySingletonObjects.remove(beanName); // ç¡®ä¿äºŒçº§ç¼“å­˜æ²¡æœ‰æ­¤å¯¹è±¡
      this.registeredSingletons.add(beanName);
    }
  }
}

@FunctionalInterface
public interface ObjectFactory&lt;T&gt; {
  T getObject() throws BeansException;
}
</code></pre>
<p>Spring åœ¨å®ä¾‹åŒ–å¯¹è±¡çš„ä¹‹åï¼Œå°±ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ª Bean å·¥å‚ï¼Œå¹¶å°†æ­¤å·¥å‚åŠ å…¥åˆ°ä¸‰çº§ç¼“å­˜ä¸­ã€‚<br>
å› æ­¤ï¼ŒSpring ä¸€å¼€å§‹æå‰æš´éœ²çš„å¹¶ä¸æ˜¯å®ä¾‹åŒ–çš„ Beanï¼Œè€Œæ˜¯å°† Bean åŒ…è£…èµ·æ¥çš„ ObjectFactoryã€‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>è¿™å®é™…ä¸Šæ¶‰åŠåˆ° AOPï¼Œå¦‚æœåˆ›å»ºçš„ Bean æ˜¯æœ‰ä»£ç†çš„ï¼Œé‚£ä¹ˆæ³¨å…¥çš„å°±åº”è¯¥æ˜¯ä»£ç† Beanï¼Œè€Œä¸æ˜¯åŸå§‹çš„ Beanã€‚ä½†æ˜¯ Spring ä¸€å¼€å§‹å¹¶ä¸çŸ¥é“ Bean æ˜¯å¦ä¼šæœ‰å¾ªç¯ä¾èµ–ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼ˆæ²¡æœ‰å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹ï¼‰ï¼ŒSpring éƒ½ä¼šåœ¨å®Œæˆå¡«å……å±æ€§ï¼Œå¹¶ä¸”æ‰§è¡Œå®Œåˆå§‹åŒ–æ–¹æ³•ä¹‹åå†ä¸ºå…¶åˆ›å»ºä»£ç†ã€‚ä½†æ˜¯ï¼Œå¦‚æœå‡ºç°äº†å¾ªç¯ä¾èµ–çš„è¯ï¼ŒSpring å°±ä¸å¾—ä¸ä¸ºå…¶æå‰åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¦åˆ™æ³¨å…¥çš„å°±æ˜¯ä¸€ä¸ªåŸå§‹å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä»£ç†å¯¹è±¡ã€‚å› æ­¤ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°åº”è¯¥åœ¨å“ªé‡Œæå‰åˆ›å»ºä»£ç†å¯¹è±¡ï¼Ÿ</p>
<p>Spring çš„åšæ³•å°±æ˜¯åœ¨ ObjectFactory ä¸­å»æå‰åˆ›å»ºä»£ç†å¯¹è±¡ã€‚å®ƒä¼šæ‰§è¡Œ getObject() æ–¹æ³•æ¥è·å–åˆ° Beanã€‚å®é™…ä¸Šï¼Œå®ƒçœŸæ­£æ‰§è¡Œçš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">protected Object getEarlyBeanReference(String beanName, RootBeanDefinition mbd, Object bean) {
  Object exposedObject = bean;
  if (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) {
    for (BeanPostProcessor bp : getBeanPostProcessors()) {
      if (bp instanceof SmartInstantiationAwareBeanPostProcessor) {
        SmartInstantiationAwareBeanPostProcessor ibp = (SmartInstantiationAwareBeanPostProcessor) bp;
        // å¦‚æœéœ€è¦ä»£ç†ï¼Œè¿™é‡Œä¼šè¿”å›ä»£ç†å¯¹è±¡ï¼›å¦åˆ™è¿”å›åŸå§‹å¯¹è±¡
        exposedObject = ibp.getEarlyBeanReference(exposedObject, beanName);
      }
    }
  }
  return exposedObject;
}
</code></pre>
<p>å› ä¸ºæå‰è¿›è¡Œäº†ä»£ç†ï¼Œé¿å…å¯¹åé¢é‡å¤åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œä¼šåœ¨ earlyProxyReferences ä¸­è®°å½•å·²è¢«ä»£ç†çš„å¯¹è±¡ã€‚</p>
<pre><code class="language-java">public abstract class AbstractAutoProxyCreator extends ProxyProcessorSupport
    implements SmartInstantiationAwareBeanPostProcessor, BeanFactoryAware {
  @Override
  public Object getEarlyBeanReference(Object bean, String beanName) {
    Object cacheKey = getCacheKey(bean.getClass(), beanName);
    // è®°å½•å·²è¢«ä»£ç†çš„å¯¹è±¡
    this.earlyProxyReferences.put(cacheKey, bean);
    return wrapIfNecessary(bean, beanName, cacheKey);
  }
}
</code></pre>
<h3 id="ä¸ºä»€ä¹ˆè¦ç”¨ç¬¬äºŒçº§ç¼“å­˜å‘¢">ä¸ºä»€ä¹ˆè¦ç”¨ç¬¬äºŒçº§ç¼“å­˜å‘¢ï¼Ÿ</h3>
<p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœå‡ºç°ä»¥ä¸‹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬è¦å¦‚ä½•å¤„ç†ï¼Ÿ</p>
<pre><code class="language-java">@Service
public class TestService1 {

    @Autowired
    private TestService2 testService2;
    @Autowired
    private TestService3 testService3;

    public void test1() {
    }
}
</code></pre>
<pre><code class="language-java">@Service
public class TestService2 {

    @Autowired
    private TestService1 testService1;

    public void test2() {
    }
}
</code></pre>
<pre><code class="language-java">@Service
public class TestService3 {

    @Autowired
    private TestService1 testService1;

    public void test3() {
    }
}
</code></pre>
<p>TestService1ä¾èµ–äºTestService2å’ŒTestService3ï¼Œè€ŒTestService2ä¾èµ–äºTestService1ï¼ŒåŒæ—¶TestService3ä¹Ÿä¾èµ–äºTestService1ã€‚<br>
æŒ‰ç…§ä¸Šå›¾çš„æµç¨‹å¯ä»¥æŠŠTestService1æ³¨å…¥åˆ°TestService2ï¼Œå¹¶ä¸”TestService1çš„å®ä¾‹æ˜¯ä»ç¬¬ä¸‰çº§ç¼“å­˜ä¸­è·å–çš„ã€‚</p>
<p>å‡è®¾ä¸ç”¨ç¬¬äºŒçº§ç¼“å­˜ï¼ŒTestService1æ³¨å…¥åˆ°TestService3çš„æµç¨‹å¦‚å›¾ï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://jzf936389030.github.io/BoiledPork/post-images/1666057128625.png" alt="" loading="lazy"></figure>
<p><strong>TestService1æ³¨å…¥åˆ°TestService3åˆéœ€è¦ä»ç¬¬ä¸‰çº§ç¼“å­˜ä¸­è·å–å®ä¾‹ï¼Œè€Œç¬¬ä¸‰çº§ç¼“å­˜é‡Œä¿å­˜çš„å¹¶éçœŸæ­£çš„å®ä¾‹å¯¹è±¡ï¼Œè€Œæ˜¯ObjectFactoryå¯¹è±¡ã€‚è¯´ç™½äº†ï¼Œä¸¤æ¬¡ä»ä¸‰çº§ç¼“å­˜ä¸­è·å–éƒ½æ˜¯ObjectFactoryå¯¹è±¡ï¼Œè€Œé€šè¿‡å®ƒåˆ›å»ºçš„å®ä¾‹å¯¹è±¡æ¯æ¬¡å¯èƒ½éƒ½ä¸ä¸€æ ·çš„(TestService3å’ŒTestService2å½“ä¸­çš„TestService1ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡)</strong><br>
<strong>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œspringå¼•å…¥çš„ç¬¬äºŒçº§ç¼“å­˜ã€‚ä¸Šé¢å›¾1å…¶å®TestService1å¯¹è±¡çš„å®ä¾‹å·²ç»è¢«æ·»åŠ åˆ°ç¬¬äºŒçº§ç¼“å­˜ä¸­äº†ï¼Œè€Œåœ¨TestService1æ³¨å…¥åˆ°TestService3æ—¶ï¼Œåªç”¨ä»ç¬¬äºŒçº§ç¼“å­˜ä¸­è·å–è¯¥å¯¹è±¡å³å¯ã€‚</strong><br>
<img src="https://jzf936389030.github.io/BoiledPork/post-images/1666057261106.png" alt="" loading="lazy"></p>
<hr>
<hr>
<p>å‚è€ƒèµ„æ–™ï¼š<br>
https://cloud.tencent.com/developer/article/1769948<br>
https://cloud.tencent.com/developer/article/1497692<br>
https://www.cainiaojc.com/note/qa38bw.html<br>
å¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³» 936389030@qq.com åˆ é™¤ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[BeanFactoryè¯¦è§£]]></title>
        <id>https://jzf936389030.github.io/BoiledPork/post/beanfactory-xiang-jie/</id>
        <link href="https://jzf936389030.github.io/BoiledPork/post/beanfactory-xiang-jie/">
        </link>
        <updated>2022-09-22T11:21:59.000Z</updated>
        <content type="html"><![CDATA[<p>BeanFactoryå®šä¹‰äº†IOCå®¹å™¨çš„æœ€åŸºæœ¬å½¢å¼ï¼Œå¹¶æä¾›äº†IOCå®¹å™¨åº”éµå®ˆçš„çš„æœ€åŸºæœ¬çš„æ¥å£ã€‚</p>
<p>é¦–å…ˆå®šä¹‰éœ€è¦ä½¿ç”¨çš„ç±»</p>
<pre><code class="language-java">public class PhoneApplication {
    @Configuration
    static class Config {
        @Bean
        public Bean1 bean1() {
            return new Bean1();
        }

        @Bean
        public Bean2 bean2() {
            return new Bean2();
        }
    }
static class Bean1 {
        private static final Logger log = LoggerFactory.getLogger(Bean1.class);

        public Bean1() {
            log.debug(&quot;æ„é€  Bean1()&quot;);
        }

        @Autowired
        private Bean2 bean2;

        public Bean2 getBean2() {
            return bean2;
        }

       
    }
static class Bean2 {
        private static final Logger log = LoggerFactory.getLogger(Bean2.class);

        public Bean2() {
            log.debug(&quot;æ„é€  Bean2()&quot;);
        }
    }

}
</code></pre>
<p>DefaultListableBeanFactory æ˜¯BeanFactory æœ€é‡è¦çš„å®ç°</p>
<h3 id="ä½¿ç”¨-defaultlistablebeanfactory-æ·»åŠ beançš„å®šä¹‰">ä½¿ç”¨ DefaultListableBeanFactory æ·»åŠ beançš„å®šä¹‰</h3>
<pre><code class="language-java">public static void main(String[] args) {
DefaultListableBeanFactory beanFactory = new DefaultListableBeanFactory();
        // bean çš„å®šä¹‰ï¼ˆclass, scope, åˆå§‹åŒ–, é”€æ¯ï¼‰
AbstractBeanDefinition beanDefinition =
                BeanDefinitionBuilder.genericBeanDefinition(Config.classï¼‰.setScope(&quot;singleton&quot;).getBeanDefinition();
        //æ„é€ å¥½åæ”¾å…¥beanFactory
beanFactory.registerBeanDefinition(&quot;config&quot;, beanDefinition);

for (String beanDefinitionName : beanFactory.getBeanDefinitionNames()) {
            System.err.println(beanDefinitionName);
        }
}
</code></pre>
<p>æ‰§è¡Œç»“æœ<br>
<img src="https://jzf936389030.github.io/BoiledPork/post-images/1663846627767.jpg" alt="" loading="lazy"><br>
å‘ç°æ‰“å°å‡ºæ¥çš„åªæœ‰configè¿™ä¸€ä¸ªbeanï¼Œå…¶ä¸­çš„bean1ã€bean2å¹¶æ²¡æœ‰è¢«æ‰“å°å‡ºæ¥ï¼Œä¹Ÿå°±è¯´æ˜äº†bean1ã€bean2 ä¸Šæ–¹æ·»åŠ @Beanæ³¨è§£å¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œæ‰€ä»¥å¾—å‡ºç»“è®ºï¼šbeanFactoryå¹¶æ²¡æœ‰è§£æ@Configurationã€@Beanã€@Autowiredçš„åŠŸèƒ½ã€‚</p>
<h3 id="è§£æå„ç§çš„æ³¨è§£å¹¶ä¸æ˜¯beanfactoryçš„åŠŸèƒ½è€Œæ˜¯ç”±å„ç§åå¤„ç†å™¨æä¾›çš„">è§£æå„ç§çš„æ³¨è§£å¹¶ä¸æ˜¯beanFactoryçš„åŠŸèƒ½ï¼Œè€Œæ˜¯ç”±å„ç§åå¤„ç†å™¨æä¾›çš„</h3>
<p>ç»™beanFactoryæ·»åŠ å„ç§åå¤„ç†å™¨</p>
<pre><code class="language-java">AnnotationConfigUtils.registerAnnotationConfigProcessors(beanFactory);
</code></pre>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">Config
//è§£æ@Configuration
org.springframework.context.annotation.internalConfigurationAnnotationProcessor
//è§£æ@Autowired
org.springframework.context.annotation.internalAutowiredAnnotationProcessor
//è§£æ@Resource
org.springframework.context.annotation.internalCommonAnnotationProcessor
org.springframework.context.event.internalEventListenerProcessor
org.springframework.context.event.internalEventListenerFactory
</code></pre>
<p>æ­¤æ—¶æ‰“å°ä¿¡æ¯ä¸­å·²ç»å‡ºç°äº†å„ç§åå¤„ç†å™¨ï¼Œä½†bean1ã€bean2å¹¶æ²¡æœ‰è¢«æ‰“å°å‡ºæ¥ï¼Œæˆ‘ä»¬æ¥ä¸‹å¾€ä¸‹çœ‹<br>
æ­¤å‰æˆ‘ä»¬åªæ˜¯æŠŠå„ç§åå¤„ç†å™¨æ·»åŠ åˆ°beanFactoryä¸­ï¼Œä½†å®ƒä»¬å¹¶æ²¡æœ‰å·¥ä½œï¼Œæ¢å¥è¯è¯´å°±æ˜¯ï¼Œæ­¤æ—¶æ·»åŠ çš„åå¤„ç†å™¨å¹¶æ²¡æœ‰è·ŸbeanFactoryäº§ç”Ÿå…³ç³»,æ·»åŠ ä»¥ä¸‹ä»£ç å³å¯è®©ä»–ä»¬äº§ç”Ÿã€‚</p>
<pre><code class="language-java">        //è·å–å„ç§BeanFactoryåå¤„ç†å™¨
beanFactory.getBeansOfType(BeanFactoryPostProcessor.class).values().forEach(beanFactoryPostProcessor -&gt; {
            beanFactoryPostProcessor.postProcessBeanFactory(beanFactory);
        });
for (String beanDefinitionName : beanFactory.getBeanDefinitionNames()) {
            System.err.println(beanDefinitionName);
        }
</code></pre>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼šbean1ã€bean2å·²ç»è¢«æ‰“å°å‡ºæ¥äº†</p>
<pre><code class="language-java">Config
org.springframework.context.annotation.internalConfigurationAnnotationProcessor
org.springframework.context.annotation.internalAutowiredAnnotationProcessor
org.springframework.context.annotation.internalCommonAnnotationProcessor
org.springframework.context.event.internalEventListenerProcessor
org.springframework.context.event.internalEventListenerFactory
bean1
bean2
</code></pre>
<p>ä½†æ­¤æ—¶è·å–çš„beanå¹¶ä¸æ˜¯å®Œå…¨å¯ç”¨çš„ï¼Œæˆ‘ä»¬æ‰“å°ä¸‹</p>
<pre><code class="language-java">System.out.println(beanFactory.getBean(Bean1.class).getBean2());
</code></pre>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">20:31:07.628 [main] DEBUG com.pig4cloud.pig.phone.PhoneApplication$Bean1 - æ„é€  Bean1()
null

</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹å‡º bean1 æ„é€ å‡ºæ¥äº†ï¼Œä½†bean2å´æ²¡æœ‰,è¿™æ˜¯å› ä¸º@Autowiredçš„åŠŸèƒ½è¿˜å¹¶æ²¡æœ‰è¢«å®ç°ï¼Œæ­¤å‰æˆ‘ä»¬æ·»åŠ çš„æ˜¯ beanFactoryçš„åå¤„ç†å™¨ï¼Œè§£æçš„æ˜¯@beanï¼Œè¦å¤„ç†@Autowiredã€@Configurationæ³¨è§£ï¼Œåˆ™éœ€è¦æ·»åŠ beançš„åå¤„ç†å™¨ï¼Œä¸‹é¢ä¸Šä»£ç </p>
<pre><code class="language-java">// Bean åå¤„ç†å™¨, é’ˆå¯¹ bean çš„ç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªé˜¶æ®µæä¾›æ‰©å±•, ä¾‹å¦‚ @Autowired @Resource ...
beanFactory.getBeansOfType(BeanPostProcessor.class).values().forEach(beanPostProcessor -&gt; {
            beanFactory.addBeanPostProcessor(beanPostProcessor);
        });
</code></pre>
<p>æ‰“å°ç»“æœï¼š</p>
<pre><code class="language-java">20:36:30.885 [main] DEBUG com.pig4cloud.pig.phone.PhoneApplication$Bean1 - æ„é€  Bean1()
20:36:30.896 [main] DEBUG org.springframework.beans.factory.support.DefaultListableBeanFactory - Creating shared instance of singleton bean 'bean2'
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://jzf936389030.github.io/BoiledPork/post/hello-gridea/</id>
        <link href="https://jzf936389030.github.io/BoiledPork/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="https://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>